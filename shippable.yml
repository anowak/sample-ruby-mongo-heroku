language: ruby
rvm:
  - 1.9.3

services:
   - mongodb

env:
  global:
    - APP_NAME=thawing-journey-6674
    - MONGOLAB_URI=mongodb://localhost/test
    - CI_REPORTS=shippable/testresults/results.xml COVERAGE_REPORTS=shippable/codecoverage
    - secure: ERb0uJlcmV00d3yb97YAKLDaMerbqqtX90EifC5T6XsdNzALvUyfLp/c7P8F7cpmkIUh/vR/beu5RVqWOwZu+/ZkKINS4Q6xB4xDjmHGxZ4cjTZjCQCawh6CvgJZK/Ty+1P+kepEpZUyzI7W30d+1wDJ/osPC63XKfVRSvbQbYXJhaOsbA30ED/qlE+vbJs0ff3PPWCkZRCXdzipnABd2v4vuGX224BMtCrvZghzpzMOsj81jAl5bLxIJ4SDuAjfAj5kUKmcyK+YCVGFmU3HlBILXw66HKS/XJ8bVygMD5dCeLoOkwbegjV3nAtRgqOa1wM8AH91dX/gzQGCqK5fbQ==

before_install:
  - which heroku || wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh

before_script: 
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage

after_success:
  - test -f ~/.ssh/id_rsa.heroku || ssh-keygen -y -f ~/.ssh/id_rsa > ~/.ssh/id_rsa.heroku && heroku keys:add ~/.ssh/id_rsa.heroku
  - git remote -v | grep ^heroku || heroku git:remote --app $APP_NAME
  - git push -f heroku $BRANCH:master
  - heroku run rake db:migrate
